---
mode: 'agent'
description: '製品要件文書に基づいて、エピックの高レベル技術アーキテクチャを作成するためのプロンプト。'
---

# エピック アーキテクチャ仕様プロンプト

## 目標

シニアソフトウェアアーキテクトとして行動してください。あなたのタスクは、エピックPRDを受け取り、高レベルの技術アーキテクチャ仕様を作成することです。この文書は、主要なコンポーネント、機能、必要な技術的実装要素を概説し、エピックの開発を導きます。

## コンテキスト考慮事項

- プロダクトマネージャーからのエピックPRD
- モジュラーでスケーラブルなアプリケーションのための**ドメイン駆動アーキテクチャ**パターン
- **セルフホストおよびSaaS展開**要件
- すべてのサービスの**Dockerコンテナ化**
- App Routerを使用した**TypeScript/Next.js**スタック
- **Turborepoモノレポ**パターン
- 型安全なAPIのための**tRPC**
- 認証のための**Stack Auth**

**注意：** 技術的状況における疑似コードでない限り、出力にコードを書かないでください。

## 出力形式

出力は、`/docs/ways-of-work/plan/{epic-name}/arch.md`に保存される、Markdown形式での完全なエピックアーキテクチャ仕様である必要があります。

### 仕様構造

#### 1. エピックアーキテクチャ概要

- エピックの技術的アプローチの簡潔な要約

#### 2. システムアーキテクチャ図

このエピックの完全なシステムアーキテクチャを図示する包括的なMermaid図を作成してください。図には以下を含める必要があります：

- **ユーザー層**：異なるユーザータイプ（Webブラウザ、モバイルアプリ、管理インターフェース）がシステムとどのように相互作用するかを示す
- **アプリケーション層**：ロードバランサー、アプリケーションインスタンス、認証サービス（Stack Auth）を描画
- **サービス層**：tRPC API、バックグラウンドサービス、ワークフローエンジン（n8n）、およびエピック固有のサービスを含む
- **データ層**：データベース（PostgreSQL）、ベクターデータベース（Qdrant）、キャッシュ層（Redis）、外部API統合を示す
- **インフラストラクチャ層**：Dockerコンテナ化と展開アーキテクチャを表現

これらの層を整理するために明確なサブグラフを使用し、異なるコンポーネントタイプに一貫したカラーコーディングを適用し、コンポーネント間のデータフローを示してください。エピックに関連する同期リクエストパスと非同期処理フローの両方を含めてください。

#### 3. 高レベル機能と技術的実装要素

- 構築される高レベル機能のリスト
- 機能をサポートするために必要な技術的実装要素（例：新しいサービス、ライブラリ、インフラストラクチャ）のリスト

#### 4. 技術スタック

- 使用される主要な技術、フレームワーク、ライブラリのリスト

#### 5. 技術的価値

- 簡潔な正当化を伴う技術的価値の推定（例：高、中、低）

#### 6. Tシャツサイズ見積もり

- エピックの高レベルTシャツサイズ見積もりを提供（例：S、M、L、XL）

## コンテキストテンプレート

- **エピックPRD：** [エピックPRDマークダウンファイルの内容]